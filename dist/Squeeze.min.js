/*!
 * Squeeze.js v0.1
 * http://squeeze.s-media.si/
 *
 * Copyright 2015, Matej Å ircelj
 * Released under the MIT license
 *
 * Date: 2015-05-09
 */

function Squeeze(t,s,e,i){this.font_sizes=t,this.highest_too_small_height=0,this.lowest_too_big_height=void 0,this.current_font_index=void 0,this.font_indexes=Object.keys(t),this.last_response=void 0,this.box_height=s,this.box_width=e,this.words=i,this.steps=0,this.computeWordsLengths=function(t,s){if(current_word=0,word_lengths={0:0},!this.font_sizes[s])return!1;for(var e=0,i=t.length;i>e;e++)" "==t[e]?(current_word++,word_lengths[current_word]=0):word_lengths[current_word]+="undefined"==typeof this.font_sizes[s][t[e].charCodeAt(0)]?this.font_sizes[s].max:this.font_sizes[s][t[e].charCodeAt(0)];return word_lengths},this.wordsFitInTheBox=function(){var t=parseInt(this.current_font_index.substring(0,this.current_font_index.length-3)),s=(parseInt(this.current_font_index.substring(this.current_font_index.length-3,this.current_font_index.length)),this.computeWordsLengths(this.words,this.current_font_index)),e=Math.floor(this.box_height/t),i=Math.floor(this.box_height/e);if("undefined"==typeof this.font_sizes[this.current_font_index][160])var h=this.font_sizes[this.current_font_index].max;else var h=this.font_sizes[this.current_font_index][160];words_in_one_line_length=0,occupied_lines=0,total_words=0;var n=-1,o=[],_=[];for(var r in s){if(s[r]>this.box_width)return{info:"single word is wider than the whole line - change font height",fit:1,font_index:this.current_font_index,steps:this.steps,ltbs:this.lowest_too_big_height,htss:this.highest_too_small_height};0!==words_in_one_line_length&&words_in_one_line_length+s[r]+h<=this.box_width?(o[n].push(s[r]),_[n]+=s[r],words_in_one_line_length+=s[r]+h):(n++,o[n]=[],o[n].push(s[r]),_[n]=s[r],words_in_one_line_length=s[r],occupied_lines++),total_words++}return occupied_lines*t>e*i?{info:"try lower font height",fit:1,font_index:this.current_font_index,steps:this.steps,ltbs:this.lowest_too_big_height,htss:this.highest_too_small_height}:{info:"try higher font height",fit:-1,font_index:this.current_font_index,steps:this.steps,ltbs:this.lowest_too_big_height,htss:this.highest_too_small_height}},this.pad=function(t){return("000"+t).substr(-3)},this.getClosest=function(t){for(var s=-1,e=this.font_indexes.length;e-s>1;){var i=Math.round((s+e)/2);parseInt(this.font_indexes[i])<=parseInt(t)?s=i:e=i}return this.font_indexes[s]==t&&(e=s),[this.font_indexes[s],this.font_indexes[e]]},this.getFontBetween=function(t,s,e){var i=Math.round((parseInt(t)+parseInt(s))/2);e||(e="lower");{var h=this.getClosest(i,e);parseInt(h[1].substring(0,h[1].length-3)),parseInt(h[1].substring(h[1].length-3,h[1].length))}return"lower"==e?h[0]:h[1]},this.tryNextFontSize=function(){if(-1!=this.font_indexes.indexOf(this.lowest_too_big_height)&&-1!=this.font_indexes.indexOf(this.highest_too_small_height)&&this.font_indexes.indexOf(this.lowest_too_big_height)-this.font_indexes.indexOf(this.highest_too_small_height)<=1)return{fit:0,font_index:this.highest_too_small_height,steps:this.steps,ltbs:this.lowest_too_big_height,htss:this.highest_too_small_height};if(this.steps++,this.last_response)this.last_response.fit<0?(this.highest_too_small_height<this.last_response.font_index?this.highest_too_small_height=this.last_response.font_index:(this.highest_too_small_height=this.last_response.font_index)&&(this.highest_too_small_height=""+this.highest_too_small_height++),this.current_font_index=this.getFontBetween(this.last_response.font_index,this.lowest_too_big_height,"higher")):this.last_response.fit>0&&(this.lowest_too_big_height>this.last_response.font_index?this.lowest_too_big_height=this.last_response.font_index:(this.lowest_too_big_height=this.last_response.font_index)&&(this.lowest_too_big_height=""+this.lowest_too_big_height--),this.current_font_index=this.getFontBetween(this.highest_too_small_height,this.lowest_too_big_height,"lower"));else{var t=this.getClosest(this.box_height+this.pad(this.box_height));this.lowest_too_big_height=t[1]?t[1]:t[0],this.current_font_index=this.getFontBetween(0,this.lowest_too_big_height)}return this.last_response=this.wordsFitInTheBox(),this.last_response},this.getBestFontSize=function(){var t=0;do t++,this.last_response=this.tryNextFontSize();while(0!==this.last_response.fit&&40>t);return this.last_response.font_size=this.last_response.font_index.substring(this.last_response.font_index.length-3,this.last_response.font_index.length),this.last_response.line_height=this.last_response.font_index.substring(0,this.last_response.font_index.length-3),this.last_response}}